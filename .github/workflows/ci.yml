name: UiPath CI Pipeline

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build-and-deploy:
    runs-on: windows-latest

    steps:
    - name: ğŸ“¦ Checkout code
      uses: actions/checkout@v4

    - name: ğŸ”§ TÃ©lÃ©charger et configurer UiPath CLI
      shell: powershell
      run: |
        Invoke-WebRequest -Uri "https://github.com/UiPath/uipathcli/releases/latest/download/uipathcli-windows-amd64.zip" -OutFile "uipathcli.zip"
        Expand-Archive -Path "uipathcli.zip" -DestinationPath "uipcli"

    - name: ğŸ“¦ Packager le projet UiPath
      shell: powershell
      run: |
        ./uipcli/uipath.exe packages pack --input-folder ./copa --output-folder ./copa/output

    - name: ğŸ” Authentification Ã  Orchestrator
      shell: powershell
      run: |
        ./uipcli/uipath.exe login --client-id "${{ secrets.UIPATH_CLIENT_ID }}" --client-secret "${{ secrets.UIPATH_CLIENT_SECRET }}" --account-name "${{ secrets.UIPATH_ACCOUNT_LOGICAL_NAME }}" --tenant "${{ secrets.UIPATH_TENANT }}" --url "${{ secrets.UIPATH_ORCHESTRATOR_URL }}"

    - name: ğŸš€ DÃ©ployer le package vers Orchestrator
      shell: powershell
      run: |
        ./uipcli/uipath.exe packages push --package-path ./copa/output/*.nupkg
