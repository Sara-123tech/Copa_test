name: Run UiPath Job

on:
  push:
    branches:
      - main

jobs:
  run-uipath-job:
    runs-on: windows-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Download and extract UiPath CLI
        run: |
          Invoke-WebRequest -Uri "https://github.com/UiPath/uipathcli/releases/latest/download/uipathcli-windows-amd64.zip" -OutFile "uipathcli.zip"
          Expand-Archive -Path "uipathcli.zip" -DestinationPath "."

      - name: Authenticate with UiPath
        run: |
          ./uipath.exe auth login `
            --client-id "bb0ca32f-3861-4fbf-9d79-a28ed5488d3d" `
            --client-secret "7r2TgKjr7PL6~XJ(" `
            --account "sara beji" `
            --tenant "DefaultTenant" `
            --profile "ci-profile"
        env:
          UIPATH_CLIENT_ID: bb0ca32f-3861-4fbf-9d79-a28ed5488d3d
          UIPATH_CLIENT_SECRET: 7r2TgKjr7PL6~XJ(
          UIPATH_ACCOUNT: sara beji
          UIPATH_TENANT: DefaultTenant

      - name: Start UiPath Job
        run: |
          ./uipath.exe automation jobs start `
            --folder-path "Default" `
            --process-name "copa_Test" `
            --machine-name "DESKTOP-AU06I1G" `  # Remplacez par le nom de votre machine
            --profile "ci-profile"